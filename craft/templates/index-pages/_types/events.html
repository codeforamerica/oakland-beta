{% extends '_base.html' %}

{% block page_scripts %}
<script src="{{ craft.config.rootUrl }}/resources/js/filterbox.js"></script>
{% endblock %}

{% block content %}
{% set eventsEntry = craft.venti.allEvents() %}
{% set relatedEntry = null %}
{% if craft.request.getParam('q') %}
  {% set query = craft.request.getParam('q') %}
  {% set relatedEntry = craft.entries.slug(query).first() %}
  {% set eventsEntry = craft.venti.allEvents().relatedTo(relatedEntry) %}
{% endif %}

<main class="events-index">

  <div class="main-overlay"></div>

  <section class="subheader">
    <div class="breadcrumb-wrap">
      <nav class="breadcrumbs">
        <a href="{{ siteUrl }}">{{"Oakland" | translate }}</a>
        <span>{% if relatedEntry %}{{ relatedEntry.title }} | {% endif %}{{"Events" | translate }}</span>
      </nav>
    </div>
    <div class="container">
      <div class="grid-row">
        <div class="width-two-thirds section-info">
          <h1>{% if relatedEntry %}{{ relatedEntry.title }} | {% endif %}{{"Events" | translate }}</h1>
          <p>Explore events happening around the City of Oakland.</p>
        </div>
      </div>
      
    </div>
  </section>

  <form class="filterbox">
    <div class="container">
      <div class="grid-row">
        <div class="width-one-whole">
          <p>Search by Keyword</p>
          <div class="filterbox-search">
            <input class="filterbox-search-input" />
            <a href="#" class="btn btn-small filterbox-search-button">Search <span class="lnr lnr-small lnr-arrow-right"></span></a>
          </div>
          <hr>
          <ul class="filterbox-filters">
            <li class="filterbox-filter">
              <p class="filterbox-filter-label">Occuring After <span class="lnr lnr-small lnr-chevron-down"></span></p>
              <div class="filterbox-drawer">
                
              </div>
            </li>
            <li class="filterbox-filter">
              <p class="filterbox-filter-label">Occuring Before <span class="lnr lnr-small lnr-chevron-down"></span></p>
              <div class="filterbox-drawer">
                
              </div>
            </li>
            <li class="filterbox-filter">
              <p class="filterbox-filter-label">Event Type <span class="lnr lnr-small lnr-chevron-down"></span></p>
              <div class="filterbox-drawer">
                
              </div>
            </li>
            <li class="filterbox-filter">
              <p class="filterbox-filter-label">Neighborhood <span class="lnr lnr-small lnr-chevron-down"></span></p>
              <div class="filterbox-drawer">
                
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </form>

  <section>
    <div class="container">
      {% for event in eventsEntry %} 

      <div class="post-excerpt grid-row">
        <div class="one-third">
          {% if event.eventPhoto | length > 0 %}
          <img class="post-image" src="{{ event.eventPhoto.first().url }}" alt="{{ event.eventPhoto.first().caption }}"> 
          {% endif %}
        </div>
        <div class="seven-twelfths column-shift column-last">
          <p class="post-data"><time datetime="">
            {# Is the event same date or multiday event? #}
                 {% if event.startDate|date('mdY') == event.endDate|date('mdY') %}
                     {# Is the event all day #}
                     {% if event.allDay == 1 %}
                         {# If the event is repeat also show the repeat schedule(summary) #}
                         {% if event.isrepeat == 1 %}
                             {{ event.startDate|date('l, F d, Y') }} {{ event.summary }}
                         {% else %}
                             {{ event.startDate|date('l, F d, Y') }}
                         {% endif %}
                     {% else %}
                         {# If the event is repeat also show the repeat schedule(summary) #}
                         {% if event.isrepeat %}
                             {{ event.startDate|date('l, F d, Y, g:ia') }} - {{ event.endDate|date('g:ia') }}  {{ event.summary }}
                         {% else %}
                             {{ event.startDate|date('l, F d, Y, g:ia') }} - {{ event.endDate|date('g:ia') }}
                         {% endif %}
                     {% endif %}
                 {% else %}
                     {% if event.allDay == 1 %}
                         {{ event.startDate|date('l, F d, Y') }} - {{ event.endDate|date('l, F d, Y') }}
                     {% else %}
                         {{ event.startDate|date('l, F d, Y, g:ia') }} - {{ event.endDate|date('l, F d, Y g:ia') }}
                     {% endif %}
                 {% endif %}
               </time>
             </p>
          <h3><a href="{{ event.url }}">{{ event.title }}</a></h3> 
          <p>{{ event.body | trimit(180) }}</p>
          <p><a href="{{ event.url }}">Read More</a></p>
        </div>

      </div>
      <hr>
      {% endfor %}
    </div>
  </section>

</main> 
{% endblock %}   